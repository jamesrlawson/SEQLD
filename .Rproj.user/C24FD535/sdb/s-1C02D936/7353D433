{
    "contents" : "source(\"scripts/functions.R\")\n\nlibrary(plyr)\n\ntraits <- read.csv(\"data/traits/RF_trait_data2.csv\", header=T)\n\n####### CLEAN SLA AND LMA DATA #######\n\n\n  # traits <- subset(traits, source != \"AUSTRAITS_dataset_52\") # 52 is TRY data. activate this line to remove.\n\n  # trim white spaces in units\n  \n  traits$SLA.units <- trim(traits$SLA.units)\n  traits$LMA.units <- trim(traits$LMA.units)\n  \n  # convert SLA units \n  \n  traits.SLA <- units.SLA(traits)\n  \n  #hist(subset(traits.SLA, SLA.units == \"cm2/g\")$SLA) \n  #hist(subset(traits.SLA, SLA.units == \"m2/kg\")$SLA)  # reference - distribution should centre around 10\n  \n  # convert LMA units\n  \n  traits.SLA <- units.LMA(traits.SLA)\n  traits.SLA$SLAfromLMA <- as.numeric(traits.SLA$SLAfromLMA)\n  \n  # combine native SLA with LMA-derived SLA\n  \n  traits.SLA <- data.frame(cbind(traits.SLA[\"Taxon\"], \n                              traits.SLA[\"SLA\"], \n                              traits.SLA[\"SLAfromLMA\"], \n                              traits.SLA[\"source\"]))\n  traits.SLA <- SLA_LMA.combine(traits.SLA)\n  \n  # remove duplicate entries of SLA\n  \n  traits.SLA <- na.omit(traits.SLA[!duplicated(traits.SLA[,c(\"Taxon\",\"SLA\")]),][,-3])\n  traits.SLA <- traits.SLA[order(traits.SLA$Taxon),]\n  \n  # summarise intraspecies variation in SLA\n  \n  traits.SLA.CV <- ddply(traits.SLA, \n                         .(Taxon), \n                         summarise, \n                           CV = CV(SLA),\n                           sd = sd(SLA),\n                           mean = mean(SLA),\n                           count = length(SLA))\n  \n  # find species with CV of > 0.3 for SLA\n  \n  dodgy.SLA <- traits.SLA[traits.SLA$Taxon %in% as.character(subset(traits.SLA.CV, CV > 0.3)$Taxon), ]\n  dodgy.SLA <- dodgy.SLA[order(dodgy.SLA$Taxon), ]\n  \n  # output\n  \n  write.csv(traits.SLA, \"output/traits_SLA.csv\")\n  write.csv(dodgy.SLA, \"output/dodgy_SLA.csv\")\n\n\n  # identify SLA records only available in the TRY database (52, see top of section)\n\n  # withTRY.SLA <- traits.SLA # run with this line, including TRY above\n  # sansTRY.SLA <- traits.SLA # run with this line, excluding TRY above\n  \n  # sansTRY.SLA.records <- withTRY[!withTRY.SLA$SLA %in% sansTRY.SLA$SLA,] \n  # sansTRY.SLAspecies <- withTRY[!withTRY.SLA$Taxon %in% sansTRY.SLA$Taxon,] \n\n  # results are: 17 unique records and 1 unique species (Macadamia tetraphylla)\n\n####### CLEAN LEAF AREA DATA ######\n\n  # remove duplicate entries of leaf area\n  \n  traits.leafarea <- cbind(traits[\"Taxon\"],traits[\"leaf.area\"],traits[\"source\"])\n                                                \n  \n  traits.leafarea <- na.omit(traits.leafarea[!duplicated(traits.leafarea[,c(\"Taxon\",\"leaf.area\")]),])\n  traits.leafarea <- traits.leafarea[order(traits.leafarea$Taxon),]\n  \n  # summarise intraspecies variation in leaf area\n  \n  traits.leafarea.CV <- ddply(traits.leafarea, \n                              .(Taxon), \n                              summarise, \n                              CV = CV(leaf.area),\n                              sd = sd(leaf.area),\n                              mean = mean(leaf.area),\n                              median = median(leaf.area),\n                              count = length(leaf.area))\n  \n  # find species with CV of > 0.3 for leaf area\n  \n  dodgy.leafarea <- traits.leafarea[traits.leafarea$Taxon %in% as.character(subset(traits.leafarea.CV, CV > 0.5)$Taxon), ]\n  dodgy.leafarea <- dodgy.leafarea[order(dodgy.leafarea$Taxon), ]\n  \n  \n  # output\n  \n  write.csv(traits.leafarea, \"output/traits_leafarea.csv\")\n  write.csv(dodgy.leafarea, \"output/dodgy_leafarea.csv\")\n\n####### CLEAN WOOD DENSITY DATA ######\n\ntraits.WD <- units.WD(traits)\n\ntraits.WD <- cbind(traits.WD[\"Taxon\"],traits.WD[\"wood.density\"],traits.WD[\"source\"])\n\n\ntraits.WD <- na.omit(traits.WD[!duplicated(traits.WD[,c(\"Taxon\",\"wood.density\")]),])\ntraits.WD <- traits.WD[order(traits.WD$Taxon),]\n\n# summarise intraspecies variation in wood density\n\ntraits.WD.CV <- ddply(traits.WD, \n                      .(Taxon), \n                      summarise, \n                      CV = CV(wood.density),\n                      sd = sd(wood.density),\n                      mean = mean(wood.density),\n                      median = median(wood.density),\n                      count = length(wood.density))\n\n# find species with CV of > 0.3 for wood density\n\ndodgy.wood.density <- traits.WD[traits.WD$Taxon %in% as.character(subset(traits.WD.CV, CV > 0.2)$Taxon), ]\ndodgy.wood.density <- dodgy.wood.density[order(dodgy.wood.density$Taxon), ]\n\nwrite.csv(traits.WD, \"output/traits_wooddensity.csv\")\nwrite.csv(dodgy.wood.density, \"output/dodgy_wooddensity.csv\")\n",
    "created" : 1428477170178.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "6|31|70|79|\n72|29|102|56|\n104|32|131|61|\n",
    "hash" : "3631369547",
    "id" : "7353D433",
    "lastKnownWriteTime" : 1430271589,
    "path" : "C:/Users/James/Desktop/stuff/data/analysis/R/SEQLD/scripts/trait_cleaning.R",
    "project_path" : "scripts/trait_cleaning.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_source"
}