{
    "contents" : "require(FD)\nrequire(reshape)\nrequire(vegan)\n\nhydro_to1999 <- read.csv(\"data/hydro_1975-1999.csv\")\nhydro_IQQM <- read.csv(\"data/hydro_IQQM.csv\")\nsites <- read.csv(\"data/sites.csv\")\n\n# remove Teviot @ Croftby and Burnett at U/S Maroon Dam, as neither have IQQM correlates\n\nhydro_to1999a <- hydro_to1999[-16,]\nhydro_to1999a <- hydro_to1999a[-15,]\n#hydro_IQQMa <- hydro_IQQM[-17,]\n#hydro_IQQMa <- hydro_IQQM[-15,]\n\nhydro_to1999a <- hydro_to1999a[order(hydro_to1999a$gaugeID),]\nhydro_IQQM <- hydro_IQQM[order(hydro_IQQM$gaugeID),]\n\n\nhydro_compare <- rbind(hydro_to1999a, hydro_IQQM)\nhydro_compare <- hydro_compare\n\n#hydro_compare <- hydro_compare[order(hydro_compare$gaugeID),] \n#hydro_compare <- hydro_compare[1:40,]\nrownames(hydro_compare) <- hydro_compare$gaugeName\nhydro_compare <- hydro_compare[,4:36]\nhydro_compare.dis <- vegdist(hydro_compare, method=\"gower\")\n#hydro_compare.dis <- daisy(hydro_compare, metric=\"manhattan\", stand=TRUE)\n#View(as.matrix(hydro_compare.dis))\n\n#write.csv(as.matrix(hydro_compare.dis), file=\"output/gower.csv\")\n\n\n\n# find percent change from IQQM for each metric\n\n  #hydro_to1999a[17,\"MDFAnnZer\"] <- 0.01 # incrementing zero, otherwise inf's are produced\n  #hydro_to1999a[20,\"MDFAnnZer\"] <- 0.01\n\nhydro_change <- compare.hydro(hydro_IQQM[,4:36], hydro_to1999a[,4:36])\n\n  #hydro_change[1,\"MDFAnnZer\"] <- 0 # zero divided by zero\n\nhydro_change$MDFAnnZer <- NULL # too complicated to try and work out what percent changes from zero should be\n\n# merge with alldata\n\nhydro_change$gaugeID <- hydro_to1999a$gaugeID\nhydro_change <- merge(hydro_change, sites, by = \"gaugeID\")\nhydro_change <- hydro_change[order(hydro_change$site),]\nhydro_change <- hydro_change[,2:34]\nalldata1 <- merge(alldata, hydro_change, by=\"site\", all.x = TRUE, fill=\"NA\")\n\n\n# find relationships between FDis, exotics, richness and hydrological change\n\nalldata1.short <- alldata1[,67:116]  \n\ngetAllStats(alldata1.short, alldata1.short$FDis, FD)\ngetAllStats(alldata1.short, alldata1.short$exotics, FD)\ngetAllStats(alldata1.short, alldata1.short$richness, FD)\n\n\n#write.csv(alldata1, \"output/alldata1.csv\")\n\n# modelling FDis, exotics, richness according to hydrological change\n\n  # richness\n\n  richness.hydrochange.lm <- lm(richness ~ M_MinM.y + M_MDFM.y + exotics + M_MaxM.y + MDFMDFDry.y + C_MDFM.y, data = alldata1.short)\n  stepAIC(richness.hydrochange.lm, direction =\"both\")\n\n  richness.hydrochange.lm1 <- lm(formula = richness ~ exotics + M_MaxM.y + MDFMDFDry.y + C_MDFM.y, data = alldata1[, 67:116])\n  \n  richness.hydrochange.lm2 <- lm(richness ~ clim_pwmt + clim_trng + soil_phc + clim_tcld + clim_tavg + M_MaxM.x + HSMeanDur.x + exotics + CVAnnLSMeanDur.x + M_MinM.y + M_MDFM.y + M_MaxM.y + MDFMDFDry.y + C_MDFM.y, alldata1)\n  stepAIC(richness.hydrochange.lm2, direction=\"both\")\n  \n  richness.hydrochange.lm3 <- lm(formula = richness ~ clim_pwmt + clim_trng + clim_tcld + HSMeanDur.x + \n                                   exotics + CVAnnLSMeanDur.x + M_MinM.y + M_MDFM.y + M_MaxM.y + MDFMDFDry.y + C_MDFM.y, data = alldata1)  \n  \n  AICc(richness.hydrochange.lm, richness.hydrochange.lm1, richness.hydrochange.lm2, richness.hydrochange.lm3)\n\n  vif(richness.hydrochange.lm3) # lots of autocorrelation!\n\n  # FDis \n\n    FDis.hydrochange.lm <- lm(FDis ~ C_MDFM.y + MDFAnnHSNum.y + exotics + LSMeanDur.y+ CVAnnBFI.y+ C_MinM.y+ CVAnnHSMeanDur.y, alldata1.short)\n    stepAIC(FDis.hydrochange.lm, direction = \"both\")\n    \n    FDis.hydrochange.lm1 <- lm(formula = FDis ~ C_MDFM.y + MDFAnnHSNum.y + C_MinM.y, data = alldata1.short)\n    FDis.hydrochange.lm2 <- lm(formula = FDis ~ C_MDFM.y + MDFAnnHSNum.y + C_MinM.y + soil_awc, data = alldata1)\n    \n    summary(FDis.hydrochange.lm)\n    summary(FDis.hydrochange.lm1)\n    summary(FDis.hydrochange.lm2)\n    \n    \n    AICc(FDis.hydrochange.lm, FDis.hydrochange.lm1, FDis.hydrochange.lm2)\n\n  # exotics\n\n    exotics.hydrochange.lm <- lm(exotics ~ C_MDFM.y + C_MinM.y + CVAnnMRateFall.y + BFI.y + LSMeanDur.y + CVAnnLSNum.y + HSMeanDur.y, data = alldata1.short)\n    stepAIC(exotics.hydrochange.lm, direction=\"both\") # produces maximal model\n\n    summary(exotics.hydrochange.lm)\n\n    exotics.hydrochange.signif <- data.frame(cbind(alldata1.short[\"C_MDFM.y\"],\n                                                   alldata1.short[\"C_MinM.y\"],\n                                                   alldata1.short[\"CVAnnMRateFall.y\"],\n                                                   alldata1.short[\"BFI.y\"],  \n                                                   alldata1.short[\"LSMeanDur.y\"], \n                                                   alldata1.short[\"CVAnnLSNum.y\"],  \n                                                   alldata1.short[\"HSMeanDur.y\"]))\n    \n    exotics.hydrochange.signif.pca <- prcomp(na.omit(exotics.hydrochange.signif), center=TRUE, scale=TRUE, retx=TRUE)\n    summary(exotics.hydrochange.signif.pca)\n    exotics.hydrochange.signif.pca$rotation[,1:5]\n\n    exotics.hydrochange.lm1 <- lm(exotics ~ HSMeanDur.y + LSMeanDur.y + C_MDFM.y + C_MinM.y + CVAnnMRateFall.y, alldata1.short)\n    summary(exotics.hydrochange.lm1)\n\n    exotics.hydrochange.lm2 <- lm(exotics ~ HSMeanDur.y + LSMeanDur.y + C_MDFM.y + C_MinM.y + CVAnnMRateFall.y + clim_pwrm + soil_nto, data = alldata1)\n    summary(exotics.hydrochange.lm2)\n    vif(exotics.hydrochange.lm2)\n\n    AICc(exotics.hydrochange.lm, exotics.hydrochange.lm1, exotics.hydrochange.lm2)\n\n\n\n",
    "created" : 1432082839735.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "916025277",
    "id" : "B7420EB0",
    "lastKnownWriteTime" : 1432531912,
    "path" : "C:/Users/James/Desktop/stuff/data/analysis/R/SEQLDold/scripts/hydro_analysis.R",
    "project_path" : "scripts/hydro_analysis.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "source_on_save" : false,
    "type" : "r_source"
}